<!DOCTYPE html>
<html>
    <head>
        <title>공학설계입문</title>
        <meta charset="UTF-8">
        <style>
            table {border-collapse: collapse}
            table *{border: 1px solid black; text-align: center;}
            p {
                line-height: 100%;
                margin: 0px 0px 0px 0px;
            }
        </style>
<!--        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>-->
    </head>

    <body>

    <!--
    <iframe id="iframe" name="iframe1" style="display:none"></iframe>
    -->
    <script type="text/javascript" src="/lib/sweetalert.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type='text/javascript'>
            function goHome(){
                location.href ="/";
            }
            function sum(){
                var ap = document.getElementById(arguments[0]);
                var bp = document.getElementById(arguments[1]);
                var cp = document.getElementById(arguments[2]);
                var dp = document.getElementById(arguments[3]);
                var point = 0;
                if(Number(ap.value) != -1){
                    point = point+Number(ap.value);
                }
                if(Number(bp.value) != -1){
                    point = point + Number(bp.value);
                }
                if(Number(cp.value) != -1){
                    point = point = point + Number(cp.value);
                }
                if(Number(dp.value) != -1){
                    point = point = point + Number(dp.value);
                }
                document.getElementById(arguments[4]).innerHTML=point;
            }

            function show(){
                var point = document.getElementById(arguments[0]);
                if(Number(point.value) == -1){
                    document.getElementById(arguments[1]).innerHTML="0";
                }
                else {
                    document.getElementById(arguments[1]).innerHTML = Number(point.value);
                }
            }

            function checkGrade() {
                let studentNumber = document.getElementById('studentNumber');
                let name = document.getElementById('name');
                let phoneNumber = document.getElementById('phoneNumber');

                let aPoint1_1 = document.getElementById('aPoint1_1');
                let bPoint1_1 = document.getElementById('bPoint1_1');
                let cPoint1_1 = document.getElementById('cPoint1_1');
                let dPoint1_1 = document.getElementById('dPoint1_1');

                let aPoint1_2 = document.getElementById('aPoint1_2');
                let bPoint1_2 = document.getElementById('bPoint1_2');
                let cPoint1_2 = document.getElementById('cPoint1_2');
                let dPoint1_2 = document.getElementById('dPoint1_2');

                let regExp_studentNumber = /\d{9}/;
                let regExp_name = /\D/;
                let regExp_phoneNumber = /\d{4}/;

                if (!regExp_studentNumber.test(studentNumber.value)) {
                    swal("학번을 다시 확인해 주세요", {icon: "error"});
                    //alert("학번을 다시 확인해 주세요");
                    studentNumber.focus();
                    return;
                }
                if (!regExp_name.test(name.value)) {
                    swal("이름을 다시 확인해 주세요", {icon: "error"});
                    //alert("이름을 다시 확인해 주세요");
                    name.focus();
                    return;
                }
                if (!regExp_phoneNumber.test(phoneNumber.value)) {
                    swal("전화번호를 확인해 주세요", {icon: "error"});
                    //alert("전화번호 다시 확인해 주세요");
                    phoneNumber.focus();
                    return;
                }

                var parm =
                    {
                        "studentNumber": studentNumber.value,
                        "name": name.value,
                        "phoneNumber": phoneNumber.value,

                    "gradeForms" : [{
                        "team" : "1-1조",
                        "aPoint": aPoint1_1.value,
                        "bPoint": bPoint1_1.value,
                        "cPoint": cPoint1_1.value,
                        "dPoint": dPoint1_1.value,
                    },
                    {
                        "team" : "1-2조",
                        "aPoint": aPoint1_2.value,
                        "bPoint": bPoint1_2.value,
                        "cPoint": cPoint1_2.value,
                        "dPoint": dPoint1_2.value,
                    },
                ]}
                $.ajax({
                    type : "POST",
                    url : "grade/add",
                    contentType: "application/json; charset=utf-8",

                    data : JSON.stringify(parm),
                    datatype : "json",

                    success: function(data) {
                        console.log(data);
                        var jData = JSON.parse(data);
                        console.log(jData.result);
                        if(jData.result == "update") {
                            swal({
                                title: "이전에 제출한 기록이 있습니다.",
                                text: "다시 제출 하시겠습니까?",
                                icon: "warning",
                                buttons: true,
                                //dangerMode: true,
                            }).then(updated)
                            if(updated){
                                $.ajax({
                                    type: "POST",
                                    url: "/grade/update",
                                    contentType: "application/json; charset=utf-8",

                                    data: JSON.stringify(parm),
                                    datatype: "json",
                                    success: function (data) {
                                        console.log(data);
                                        swal("업데이트 되었습니다", {
                                            icon: "success",});
                                        //alert("제출 완료");
                                        location.href = "/success";
                                    },
                                    error: function (jqXHR, textStatus, errorThrown) {
                                        swal("시스템 에러 교수님께 연락드리세요", {icon: "error"});
                                    }
                                });
                            }
                        }
                        else if(jData.result == "noData") {
                            console.log("noData")
                            swal("존재하지 않는 학생입니다. 입력내용을 다시 확인해 주세요", {icon: "error"});
                            //alert("존재하지 않는 학생입니다. " +
                                //"입력내용을 다시 확인해 주세요");
                        }
                        else if(jData.result == "noPoint") {
                            console.log("noPoint")
                            swal("채점되지 않은 항목이 존재합니다. (각 점수는 최소 1점 입니다)", {icon: "error"});
                            // alert("채점되지 않은 항목이 존재합니다. " +
                            //     "입력내용을 다시 확인해 주세요. " +
                            //     "(점수는 1,3,5점 중 하나입니다)");
                        }
                        else {
                            //alert("제출 완료");
                            swal({text: "제출 완료 되었습니다.", icon: "success", buttons :true}).
                            then(successed)
                            if (successed) {
                                location.href = "/success";
                            }
                        }
                    },
                    error: function(jqXHR,textStatus,errorThrown) {
                        swal("시스템 에러 교수님께 연락드리세요", {icon: "error"});
                        //alert("제출 에러");
                    }

                });

            }
        </script>

        <!-- <form action="grade/add" method="POST"> -->
            <!-- target="iframe1" -->
            <center>
            <h1>공학설계 입문 학생평가</h1>
            </center>

            <label>학번:</label>
            <div style="display:inline; padding:0px 0px 0px 97px;">
                <input id="studentNumber" name="studentNumber" type="text" required><br>
            </div>

            <label>이름:</label>
            <div style="display:inline; padding:0px 0px 0px 97px;">
                <input id="name" name="name" type="text" required><br>
            </div>

            <label>전화번호 뒷자리(4) : </label>
            <input id="phoneNumber" type="text" required><br>


            <h3>평가 기준 안내</h3>
                <img th:src="@{/image/grading-standard.png}" alt="grading-standard" width="735">
            <br><br>
            <h3>평가 표</h3>
            <table>
                <tr>
                    <th rowspan="2">조번호</th>
                    <th rowspan="2">과제링크</th>
                    <th colspan="4">채점기준</th>
                    <th rowspan="2">합계</th>
                </tr>
                <tr>
                    <th>노력 정도</th>
                    <th>창의성</th>
                    <th>아이디어</th>
                    <th>완성도</th>
                </tr>
                <tr>
                    <td>1-1</td>
                    <td>
                        <A href = "https://www.google.com" target ="blank">1-1조 과제 링크</A>
                    </td>
                    <td style='line-height:100%' align=center>
                        <input id="aPoint1_1" name="aPoint1_1" value = "-1" type="range"
                               onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1');
                                show('aPoint1_1','getAPoint1_1')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getAPoint1_1"> 0 </p>
                    </td>

                    <td style='line-height:100%' align=center>
                        <input id="bPoint1_1" name="bPoint1_1" value = "-1" type="range"
                               onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1');
                                show('bPoint1_1','getBPoint1_1')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getBPoint1_1"> 0 </p>
                    </td>
                    <td>
                        <input id="cPoint1_1" name="cPoint1_1" value = "-1" type="range"
                               onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1');
                                show('cPoint1_1','getCPoint1_1')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getCPoint1_1"> 0 </p>
                    </td>
                    <td>
                        <input id="dPoint1_1" name="dPoint1_1" value = "-1" type="range"
                               onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1');
                                show('dPoint1_1','getDPoint1_1')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getDPoint1_1"> 0 </p>
                    </td>
                    <td>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="write1_1" value = 0>0</p>
                    </td>
                </tr>


                <tr>
                    <td>1-2</td>
                    <td>
                        <A href = "https://www.google.com" target ="blank">1-2조 과제 링크</A>
                    </td>
                    <td style='line-height:100%' align=center>
                        <input id="aPoint1_2" name="aPoint1_2" value = "-1" type="range"
                               onchange="sum('aPoint1_2','bPoint1_2','cPoint1_2', 'dPoint1_2','write1_2');
                                show('aPoint1_2','getAPoint1_2')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getAPoint1_2"> 0 </p>
                    </td>

                    <td style='line-height:100%' align=center>
                        <input id="bPoint1_2" name="bPoint1_2" value = "-1" type="range"
                               onchange="sum('aPoint1_2','bPoint1_2','cPoint1_2', 'dPoint1_2','write1_2');
                                show('bPoint1_2','getBPoint1_2')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getBPoint1_2"> 0 </p>
                    </td>
                    <td>
                        <input id="cPoint1_2" name="cPoint1_2" value = "-1" type="range"
                               onchange="sum('aPoint1_2','bPoint1_2','cPoint1_2', 'dPoint1_2','write1_2');
                                show('cPoint1_2','getCPoint1_2')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getCPoint1_2"> 0 </p>
                    </td>
                    <td>
                        <input id="dPoint1_2" name="dPoint1_2" value = "-1" type="range"
                               onchange="sum('aPoint1_2','bPoint1_2','cPoint1_2', 'dPoint1_2','write1_2');
                                show('dPoint1_2','getDPoint1_2')" step="2" min = "-1" max ="5" required>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="getDPoint1_2"> 0 </p>
                    </td>
                    <td>
                        <p style="border:none;border-right:0px; border-top:0px; boder-left:0px; boder-bottom:0px;" id="write1_2" value = 0>0</p>
                    </td>
                </tr>

            </table>
<!--            <h3 >1-1조</h3>-->
<!--            <A href = "https://www.google.com" target ="blank">1-1조 과제 링크</A><br><br>-->
<!--            <label style="display:inline">A 점수:</label>-->
<!--            <input id="aPoint1_1" name="aPoint1_1" value = "0" type="number" onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1')" step="2" min = "1" max ="5" required>-->
<!--            <label style="display:inline" >B 점수:</label>-->
<!--            <input style="display:inline" id="bPoint1_1" name="bPoint1_1" value = "0" type="number" onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1')" step="2" min = "1" max ="5" required>-->
<!--            <label style="display:inline" >C 점수:</label>-->
<!--            <input style="display:inline" id="cPoint1_1" name="cPoint1_1" value = "0" type="number" onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1')" step="2" min = "1" max ="5" required>-->
<!--            <label style="display:inline" >D 점수:</label>-->
<!--            <input style="display:inline" id="dPoint1_1" name="dPoint1_1" value = "0" type="number" onchange="sum('aPoint1_1','bPoint1_1','cPoint1_1', 'dPoint1_1','write1_1')" step="2" min = "1" max ="5" required>-->

<!--            <br><br>-->
<!--            <p style="display:inline" > 1-1조 Total 점수:&nbsp;</p>-->
<!--            <p style="display:inline"   id="write1_1"> 0 <p>-->

            <br>
        <button type="button" onclick="checkGrade()">점수 제출</button>

        <button type="button" onclick="goHome()">취소(홈으로)</button>
        <!--</form>-->

    </body>
</html>